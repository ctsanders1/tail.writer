/* tail.writer 0.3.2 @ https://github.com/pytesNET/tail.writer */
!function(t){"use strict";var l=t,c=t.document,h={hasClass:function(t,e){return new RegExp("(|s+)"+e+"(s+|)").test(t.className)},addClass:function(t,e){return this.hasClass(t,e)||(t.className=(t.className.trim()+" "+e.trim()).trim()),t},removeClass:function(t,e){var i=new RegExp("(|s+)("+e+")(s+|)");return i.test(t.className)&&(t.className=t.className.replace(i,"$1$3").trim()),t},position:function(t,e){var i={top:t.offsetTop||0,left:t.offsetLeft||0,width:t.offsetWidth||0,height:t.offsetHeight||0};if(e)for(;t=t.offsetParent;)i.top+=t.offsetTop,i.left+=t.offsetLeft;return i},trigger:function(t,e,i){if(CustomEvent&&"undefined"!=typeof CustomEvent){var n=new CustomEvent(e,i);return t.dispatchEvent(n)}return(n=c.createEvent("CustomEvent")).initCustomEvent(e,!!i.bubbles,!!i.cancelable,i.detail),t.dispatchEvent(n)},clone:function(t,e){e="object"==typeof e?e:{};var i=t.constructor();for(var n in t)e.hasOwnProperty(n)?i[n]=e[n]:t.hasOwnProperty(n)&&(i[n]=t[n]);return i},animate:function(t,e,i,n){if(t.hasAttribute("data-tail-animation")){if(!n)return;clearInterval(h.animation[t.getAttribute("data-tail-animation")])}t.setAttribute("data-tail-animation","tail-"+ ++this.animationCounter),this.animation["tail-"+this.animationCounter]=setInterval(function(t,e,i){var n=t.getAttribute("data-tail-animation");0==e(t)&&(clearInterval(i.animation[n]),t.parentElement&&t.removeAttribute("data-tail-animation"))},i,t,e,this)},animation:{},animationCounter:0};h.IE=-1<l.navigator.userAgent.indexOf("MSIE")||-1<l.navigator.userAgent.indexOf("Edge");var d=function(t,e){if("string"==typeof t&&(t=c.querySelectorAll(t)),t instanceof NodeList||t instanceof HTMLCollection){if(0==t.length)return!1;for(var i=new Array,n=0;n<t.length;n++)i.push(new d(t[n],e));return i}return void 0===this?new d(t,e):t instanceof Element&&(t.hasAttribute("data-writer")&&d.instances[t.getAttribute(t,"data-writer")]?d.instances[t.getAttribute("data-writer")]:((e="object"==typeof e?e:{}).animate=!h.IE&&(e.animate||d.defaults.animate),this.e={container:"",editor:t,toolbar:"",statusbar:""},this.id=++d.counter,Object.assign?this.con=Object.assign({},d.defaults,e):this.con=h.clone(d.defaults,e),d.instances[this.id]=this.build(),this))};d.status="alpha",d.version="0.3.1",d.counter=0,d.instances={},d.placeholder="placeholder"in c.createElement("input"),d.defaults={width:"100%",height:["200px","500px"],classes:"",resize:!0,indentTab:!1,indentSize:4,toolbar:["headers","|","bold","italic","strikethrough","|","quote","code","codeblock","indent","outdent","|","link","image","table","hr","|","list:unordered","list:ordered","|","preview"],toolbarPosition:"top",tooltip:"top",statusbar:!0,animate:!0},d.actions={bold:{syntax:"**$1**",callback:"inline"},italic:{syntax:"_$1_",callback:"inline"},underline:{syntax:"<u>$1</u>",callback:"inline"},strikethrough:{syntax:"~~$1~~",callback:"inline"},code:{syntax:"`$1`",callback:"inline"},hr:{syntax:"----------",callback:"block",filter:function(t,e,i){return t.length!=t.lastIndexOf("\n")+1&&(e="\n"+e),i.indexOf("\n")<0&&e.indexOf("\n")<=0&&(e+="\n"),e}},codeblock:{syntax:"```\n$1\n```",callback:"inline",filter:function(t,e,i,n){return e==this.syntax.replace("$1","")||(e=e.replace(/```\n\n```/g,""),n.start+=this.syntax.indexOf("$1"),n.end=e.length-this.syntax.indexOf("$1")),e}},quote:{syntax:">\t$1",callback:"block",walker:!0},indent:{syntax:"\t$1",callback:function(t,e,i){var n=this.selection(),r=this,a=this.val.slice(0,n.start),s=this.val.slice(n.start,n.end),l=this.val.slice(n.end);return this.indent=this.indenter(this.lines.current,"count")+1,-1==s.indexOf("\n")?this.writeLine(this.indenter("\t","create"),"before"):(s=s.replace(/[^|\n].*/g,function(t){return r.indenter("\t","create")+t}),n.end=a.length+s.length,this.write(a+s+l,n))}},outdent:{syntax:!1,callback:function(t,e,i){var n=this.selection(),r=this.val.slice(0,n.start),a=this.val.slice(n.start,n.end),s=this.val.slice(n.end,this.val.length),l=this.indenter("\t"),o=new RegExp("\n"+l,"g");if(/\n/.test(a))a=a.replace(o,"\n",a);else if(0==this.lines.current.indexOf(l)){r=r.slice(0,r.lastIndexOf("\n")+1)+r.slice(r.lastIndexOf("\n")+1+l.length,r.length)}return 0==a.indexOf(l)&&(a=a.slice(l.length)),n.start=r.length,n.end=r.length+a.length,this.write(r+a+s,n)}},header:{syntax:function(t){return 1==(t=1<=t&&t<=6?parseInt(t):1)?"$1\n==========":2==t?"$1\n----------":new Array(t+1).join("#")+" $1"},callback:"block",filter:function(t,e,i,n){return"\n=========="!=e&&"\n----------"!=e||(n.start=n.end=t.length),e}},list:{title:function(t){return"list"+(t=void 0===t?"unordered":t)[0].toUpperCase()+t.slice(1)},syntax:function(t){switch(t){case"checked":return"- [x]\t$1";case"unchecked":return"- [ ]\t$1";case"ordered":return"1.\t$1"}return"-\t$1"},filter:function(t,e,i){if(0!==e.indexOf("1."))return e;var n=t.match(/^([0-9]+)\.\s+/gm);return n?e.replace("1",(n.length+1).toString()):e},callback:"block",walker:!0},headers:{syntax:self.header,callback:function(t,e,i,n){for(var r="<form>",a=1;a<=(0<n.length&&"x3"==n[0]?3:6);a++)r+='<div class="tail-writer-item tail-writer-item-header-'+a+"\">   <button onclick=\"this.parentElement.parentElement.querySelector('input').value = "+a+';">       <span class="icon-header-'+a+'" ></span> Header '+a+"   </button></div>";r+='<input type="hidden" name="header" value="" /></form>',this.showDropdown(i+(0<n.length?"-"+n.join("-"):""),r,function(t,e){var i=parseInt(t.header.value);return this.perform("header",[i<1||6<i||isNaN(i)?1:i]),!0})}},link:{syntax:"[$1](url)",callback:function(t,e,i,n){if(0==n.length)return this.do_inline(t,e,i);var r='<form>   <div class="tail-writer-row">       <span class="tail-writer-label tail-writer-label-title">'+p(i+"Title")+'</span>       <input type="text" name="title" value="" class="field-text" placeholder="'+p(i+"Title")+'" />   </div>   <div class="tail-writer-row">       <span class="tail-writer-label tail-writer-label-url">'+p(i+"URL")+'</span>       <input type="text" name="url" value="" class="field-text" placeholder="'+p(i+"URL")+'" />   </div>   <div>       <button name="type" value="'+i+'">'+p(i+"Create")+"</button>   </div></form>",a=this,s=function(t){var e=d.actions[t.type.value].syntax+" ";return e=e.replace("url",t.url.value).replace("$1",t.title.value),a.do_inline(e,a,i),!0};"dropdown"==n[0]?this.showDropdown(i+"-dropdown",r,s):this.showDialog(i+"-dialog",r,s)},filter:function(t,e,i,n){return"[](url)"==e?(n.end+="link-title".length,"[link-title](url)"):e}},image:{syntax:"![$1](url)",callback:function(t,e,i,n){d.actions.link.callback.call(this,t,e,i,n)},filter:function(t,e,i,n){return"![](url)"==e?(n.end+="image-title".length,"![image-title](url)"):e}},table:{syntax:!1,callback:function(t,e,i,n){var r='<form>   <div class="tail-writer-row">       <span class="tail-writer-label tail-writer-label-rows">'+p("tableRows")+'</span>       <input type="number" name="rows" value="3" class="field-number" placeholder="'+p("tableRows")+'" />   </div>   <div class="tail-writer-row">       <span class="tail-writer-label tail-writer-label-cols">'+p("tableCols")+'</span>       <input type="number" name="cols" value="3" class="field-number" placeholder="'+p("tableCols")+'" />   </div>   <div class="tail-writer-row">       <input type="checkbox" id="tail-writer-table-head-'+this.id+'" name="head" value="1" class="field-header" />       <label for="tail-writer-table-head-'+this.id+'">'+p("tableHead")+"</label>   </div>   <div>       <button>"+p("tableCreate")+"</button>   </div></form>",o=this,a=function(t){var e=t.head.checked,i=parseInt(t.rows.value),n=parseInt(t.cols.value);i=isNaN(i)?3:i,n=isNaN(n)?3:n;for(var r="",a=0;a<=i;a++)if(e||0!=a){for(var s=1;s<=n;s++){r+="| ";for(var l=0;l<12;l++)r+=" ";r+=" "}if(r+="|\n",0==a){for(s=1;s<=n;s++){r+="| ";for(l=0;l<12;l++)r+="-";r+=" "}r+="|\n"}}return this.do_block(r,o,"table"),!0};"dropdown"==n[0]?this.showDropdown(i+"-dropdown",r,a):this.showDialog(i+"-dialog",r,a)}}},"undefined"!=typeof marked&&(d.actions.preview={syntax:!1,callback:function(t,e,i){if(h.hasClass(this.current,"active")){h.removeClass(this.current,"active icon-editor"),h.removeClass(this.e.container,"tail-writer-preview"),h.addClass(this.current,"icon-preview"),this.current.setAttribute("data-writer-title",p("preview")),this.e.container.removeChild(this.e.container.querySelector(".tail-writer-preview")),this.e.editor.style.display="block";for(a=this.e.toolbar.querySelectorAll("button.disabled"),s=0;s<a.length;s++)h.removeClass(a[s],"disabled")}else{var n=this.e.editor.value;0==n.length&&(n=p("previewEmpty"));var r=c.createElement("DIV");r.innerHTML=d.parse(n),r.className="tail-writer-preview",r.style.width=this.e.editor.outerWidth,r.style.height=this.e.editor.outerHeight,h.removeClass(this.current,"icon-preview"),h.addClass(this.current,"active icon-editor"),h.addClass(this.e.container,"tail-writer-preview"),this.current.setAttribute("data-writer-title",p("previewExit")),this.e.editor.style.display="none",this.e.container.insertBefore(r,this.e.editor);for(var a=this.e.toolbar.querySelectorAll("button:not(.icon-editor)"),s=0;s<a.length;s++)h.addClass(a[s],"disabled")}if(MouseEvent&&MouseEvent.name){var l=new MouseEvent("mouseout");this.current.dispatchEvent(l),setTimeout(function(t){var e=new MouseEvent("mouseover");t.dispatchEvent(e)},200,this.current)}else if(c.createEvent){(l=c.createEvent("MouseEvent")).initEvent("mouseout",!0,!1,{}),this.current.dispatchEvent(l),o=this.current,setTimeout(function(){var t=c.createEvent("MouseEvent");t.initEvent("mouseover",!0,!1,{}),o.dispatchEvent(t)},200)}var o}});var u=function(t,e){if("string"!=typeof t||!d.actions.hasOwnProperty(t))return!1;var i=d.actions[t];return"function"==typeof i.syntax?i.markup=i.syntax.apply(i,e):i.markup=i.syntax,i.id=t+(0<e.length?"-"+e.join("-"):""),"function"==typeof i.title?i.string=p(i.title.apply(i,e)):i.string=p(t),i},o=function(t,e,i,n,r){return"function"==typeof t.filter?t.filter.call(t,e,i,n,r):i};d.strings={bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",code:"Inline Code",link:"Link",image:"Image",hr:"Horizontal Rule",quote:"Blockquote",indent:"Indent",outdent:"Outdent",header:"Header",codeblock:"Code Block",listOrdered:"Ordered List",listUnordered:"Unordered List",listChecked:"Checked List",listUnchecked:"Unchecked List",headers:"Headers",table:"Table",tableRows:"Rows",tableCols:"Columns",tableHead:"Include Header",tableCreate:"Create Table",linkDialog:"Link (Dialog)",imageDialog:"Image (Dialog)",tableDialog:"Table (Dialog)",linkTitle:"Link Title",linkURL:"Link URL",linkCreate:"Add Link",imageTitle:"Image Title",imageURL:"Image URL",imageCreate:"Add Image",lineCounter:"Lines",charCounter:"Characters",wordCounter:"Words"},"undefined"!=typeof marked&&(d.strings.preview="Preview",d.strings.previewEmpty="Nothing to preview yet!",d.strings.previewExit="Exit Preview Mode");var p=function(t){return d.strings.hasOwnProperty(t)?d.strings[t]:t};d.parse=function(t){if("undefined"==typeof marked)return t;var e=new marked.Renderer;return e.listitem=function(t){return/^\s*\[[x ]\]\s*/.test(t)?'<li style="list-style: none">'+(t=t.replace(/^\s*\[ \]\s*/,'<input type="checkbox"> ').replace(/^\s*\[x\]\s*/,'<input type="checkbox" checked> '))+"</li>":"<li>"+t+"</li>"},marked(t,{renderer:e})},d.extend=function(t,e,i){return!d.actions.hasOwnProperty(t)&&("object"==typeof e&&"object"==typeof i&&(d.actions[t]=e,d.strings=Object.assign(d.strings,i),!0))},d.prototype={e:{},id:0,con:{},val:"",walk:!1,lines:{},indent:0,current:0,dialogs:[],dropdowns:[],build:function(){var i=this;this.read(),this.e.container=c.createElement("div"),this.e.container.className="tail-writer-object "+this.con.classes,this.e.container.style.width=this.con.width,this.e.container.setAttribute("tail-writer-object",this.id);var t=this.e.editor.parentElement;this.e.container.appendChild(this.e.editor),t.appendChild(this.e.container),this.e.toolbar=c.createElement("div"),this.e.toolbar.className="tail-writer-toolbar tail-writer-toolbar-"+this.con.toolbarPosition,this.e.toolbar.setAttribute("data-writer-toolbar",this.con.toolbarPosition),this.e.container.insertBefore(this.e.toolbar,this.e.editor);for(var e=0;e<this.con.toolbar.length;e++){var n=this.con.toolbar[e].split(":"),r=1<n.length?n[1].split(","):[],a=u(n[0],r);if("|"===n[0]||0!=a){var s;if("|"===n[0])(s=c.createElement("span")).className="tail-writer-sep";else(s=c.createElement("button")).className="tail-writer-button icon-"+a.id,s.className="tail-writer-button icon-"+a.id,s.setAttribute("data-writer-title",a.string),s.setAttribute("data-writer-action",n[0]+(0<r.length?"-"+r.join("-"):"")),s.addEventListener("click",function(t){if((t.preventDefault(),h.hasClass(t.target,"tail-writer-button"))&&i.hideDropdown.call(i).indexOf(-1==this.getAttribute("data-writer-action"))){var e=this.getAttribute("data-writer-action").split("-");i.current=this,i.perform.call(i,e.shift(),e)}}),!1!==this.con.tooltip&&(s.addEventListener("mouseover",function(t){i.tooltip.call(i,t,this)}),s.addEventListener("mouseout",function(t){i.tooltip.call(i,t,this)}));this.e.toolbar.appendChild(s)}}if(this.con.statusbar&&(this.e.statusbar=c.createElement("div"),this.e.statusbar.className="tail-writer-statusbar",this.e.statusbar.innerHTML='<div class="tail-writer-lines">'+p("lineCounter")+': <span class="tail-writer-count"></span></div><div class="tail-writer-chars">'+p("charCounter")+': <span class="tail-writer-count"></span></div><div class="tail-writer-words">'+p("wordCounter")+': <span class="tail-writer-count"></span></div>',this.e.container.appendChild(this.e.statusbar),this.statusbar()),this.e.editor.setAttribute("data-writer-editor",this.id),isNaN(parseInt(this.con.height[0])))(l=parseInt(this.e.container.outerHeight))<200&&(l=200);else var l=parseInt(this.con.height[0]);this.e.editor.style.width=parseInt(this.con.width)+"%",this.e.editor.style.height=l+"px",this.e.editor.style.minHeight=l+"px",isNaN(parseInt(this.con.height[1]))||(this.e.editor.style.maxHeight=parseInt(this.con.height[1])+"px"),this.con.indent&&(this.e.editor.style.tabSize=this.con.indentSize),this.e.editor.className+=" tail-writer-editor";var o=["click","input","change","keydown","keyup"];for(e=0;e<o.length;e++)this.e.editor.addEventListener(o[e],function(t){i.handle.call(i,t)});return this.con.resize&&this.resize(!1),this},handle:function(t){if(this.read(),"click"==t.type&&this.hideDropdown.call(this),"keydown"===t.type){if(t.ctrlKey&&88==t.keyCode){t.preventDefault();var e=this.selection();if(e.start==e.end)for(var i=-1,n=e.end;-1<e.start;)if(i=0<e.start?this.val.indexOf("\n",e.start--):0,e.start<0||-1<i&&i<n){e.start=i,e.end=i+this.lines.current.length+1;break}return this.write(this.val.slice(0,e.start)+this.val.slice(e.end)),this.selection(e.start+1,e.start+1),!1}if(t.ctrlKey&&68==t.keyCode)return t.preventDefault(),this.writeLine("\n"+this.lines.current,"after");if(9==t.keyCode)return t.preventDefault(),t.shiftKey?this.perform("outdent",[]):this.perform("indent",[]);if(13==t.keyCode)return!this.walkable(this.lines.current)||(t.preventDefault(),this.writeLine(this.indenter("","create")),this.perform(this.walk[0],this.walk[1]))}this.con.resize&&this.resize(!0),this.con.statusbar&&this.statusbar()},walkable:function(t){if(!this.walk||null==t)return this.walk=!1;var e=u(this.walk[0],this.walk[1]),i=this.indenter(e.markup.replace("$1",""));return t.indexOf(i)<0?this.walk=!1:t!=i||(this.writeLine("","replace"),this.walk=!1)},tooltip:function(t,e){if(0==this.con.tooltip)return!1;var i=h.position(t.target),n="tail-writer-tooltip-"+t.target.getAttribute("data-writer-action");if(!h.hasClass(t.target.parentElement,"tail-writer-toolbar"))return!1;if("mouseover"==t.type){if(h.hasClass(t.target,"disabled"))return;if(0==this.e.container.querySelectorAll("."+n).length){var r=c.createElement("DIV");r.innerText=p(t.target.getAttribute("data-writer-title")),r.className="tail-writer-tooltip tail-writer-tooltip-"+this.con.tooltip+" "+n,r.style.opacity=0,r.style.position="absolute",this.e.container.insertBefore(r,this.e.container.children[0]);var a=l.getComputedStyle(this.e.toolbar);"bottom"==this.con.tooltip?r.style.top=parseInt(a.top)+i.height+r.offsetHeight+"px":r.style.top="-2px",r.style.left=parseInt(a.left)+i.left+i.width/2-r.offsetWidth/2+"px",this.con.animate?h.animate(r,function(t){return parseFloat(t.style.opacity)<1&&(t.style.opacity=parseFloat(t.style.opacity)+.1,!0)},10,!0):r.style.opacity=1}}else{(e=this.e.container.querySelector("."+n))&&this.con.animate?h.animate(e,function(t){return 0<parseFloat(t.style.opacity)?(t.style.opacity=parseFloat(t.style.opacity)-.1,!0):(t.parentElement&&t.parentElement.removeChild(t),!1)},10,!0):e&&e.parentElement&&e.parentElement.removeChild(e)}},resize:function(t){var e=this.e.editor.cloneNode(),i=l.getComputedStyle(this.e.editor),n=parseInt(i.paddingTop)+parseInt(i.paddingBottom);e.style.height="auto",e.style.minHeight="none",e.style.maxHeight="none",e.style.opacity=0,e.style.position="position",e.value=this.val,this.e.container.insertBefore(e,this.e.editor);e.scrollTop;var r=e.scrollHeight;this.e.container.removeChild(e,e.selectionStart),this.e.editor.style.height=r-n+"px",1==t&&this.e.editor.value.length-this.selection().start<=3&&(this.e.editor.scrollTop=r-n)},statusbar:function(t){var e={chars:this.val.length.toString(),lines:(this.val.match(/^|\n/g)||[""]).length.toString(),words:"0".toString()},i=this.val.trim().replace(/[\n\t\.]/g," ").trim();(i=i.replace(/[^a-zA-Z0-9 ]/g,"").replace(/\s\s+/g," ").split(" ")).length<=1&&0==i[0].length?e.words=0:e.words=i.length;var n=this.selection();if(n.start!==n.end){var r=this.val.slice(n.start,n.end);i=(i=r.trim().replace(/[\n\t\.]/g," ").trim()).replace(/[^a-zA-Z0-9 ]/g,"").replace(/\s\s+/g," ").split(" "),e.chars='<span class="current">'+r.length+" / </span>"+e.chars,e.lines='<span class="current">'+(r.match(/^|\n/g)||[""]).length+" / </span>"+e.lines,i.length<=1&&0==i[0].length?e.words='<span class="current">0 / </span>'+e.words:e.words='<span class="current">'+i.length+" / </span>"+e.words}this.e.statusbar.querySelector(".tail-writer-lines span").innerHTML=e.lines,this.e.statusbar.querySelector(".tail-writer-chars span").innerHTML=e.chars,this.e.statusbar.querySelector(".tail-writer-words span").innerHTML=e.words},selection:function(t,e){return null==t?{start:this.e.editor.selectionStart,end:this.e.editor.selectionEnd}:("number"!=typeof t&&(t=this.val.length),null==e&&(e=t),this.e.editor.focus(),this.e.editor.selectionStart=t,this.e.editor.selectionEnd=e,!0)},indenter:function(t,e){if(this.con.indentTab)var i="\t";else i=Array(this.con.indentSize+1).join(" ");if("count"===e){var n=t.replace(".",""),r=new RegExp(i,"gi");return"object"==typeof(n=n.replace(r,".").split(/([^\.])/))&&0<n.length?n[0].length:0}if("create"===e){for(var a=t.split("\n"),s=0;s<a.length;s++)0!==s&&(a[s]=Array(this.indent+1).join("\t")+a[s]);t=a.join("\n")}return this.con.indentTab||(t=t.replace(/\t/g,i)),t},read:function(){this.val=this.indenter(this.e.editor.value);var t=this.selection(),e=this.val.slice(0,t.start).split("\n"),i=this.val.slice(t.start,this.val.length).split("\n");this.lines={current:e.pop()+i.shift(),previous:0<e.length?e.pop():void 0,next:0<i.length?i.shift():void 0},this.indent=this.indenter(this.lines.current,"count")},write:function(t,e){this.e.editor.value=t,"object"==typeof e&&this.selection(e.start,e.end),this.read()},writeLine:function(t,e){var i=this.selection(),n=this.val.slice(0,i.start).split("\n"),r=this.val.slice(i.start,this.val.length).split("\n"),a=n.pop()+r.shift();n=0<n.length?n.join("\n")+"\n":"",r=0<r.length?"\n"+r.join("\n"):"","replace"==e?(this.e.editor.value=n+t+r,this.selection(n.length+t.length)):"before"==e?(this.e.editor.value=n+t+a+r,this.selection(n.length+t.length+a.split("\n")[0].length)):(this.e.editor.value=n+a+t+r,this.selection(n.length+t.length+a.length)),this.read()},showDropdown:function(t,e,i){var n=this;if(!h.hasClass(this.current,"disabled")){var r=c.createElement("DIV");r.innerHTML=e,r.className="tail-writer-dropdown tail-writer-dropdown-"+t,r.style.opacity=0,r.style.position="absolute",this.e.container.appendChild(r);var a=h.position(this.current),s=l.getComputedStyle(this.e.toolbar);r.style.top=a.top+a.height+"px",r.style.left=a.left+parseInt(s.left)+"px",r.tailWriter=i,this.con.animate?h.animate(r,function(t){return parseFloat(t.style.opacity)<1&&(t.style.opacity=parseFloat(t.style.opacity)+.1,!0)},10,!0):r.style.opacity=1,r.querySelector("form").addEventListener("submit",function(t){t.preventDefault(),this.parentElement.tailWriter.call(n,this.elements,t)&&n.hideDropdown.call(n)})}},hideDropdown:function(){var t=new Array,e=this.e.container.querySelectorAll(".tail-writer-dropdown");if(0<e.length)for(var i=0;i<e.length;i++)t.push(e[i].getAttribute("data-writer-dropdown")),this.con.animate?h.animate(e[i],function(t){return 0<parseFloat(t.style.opacity)?(t.style.opacity=parseFloat(t.style.opacity)-.1,!0):(t.parentElement.removeChild(t),!1)},10,!0):e[i].parentElement.removeChild(e[i]);return t},showDialog:function(t,e,i){var n=this;if(!h.hasClass(this.current,"disabled")){var r=c.createElement("DIV");r.className="tail-writer-mask",r.style.top=0,r.style.left=0,r.style.right=0,r.style.bottom=0,r.style.opacity=0,r.style.position="absolute",r.addEventListener("click",function(t){n.hideDialog.call(n)}),this.e.container.appendChild(r),this.con.animate?h.animate(r,function(t){return parseFloat(t.style.opacity)<1&&(t.style.opacity=parseFloat(t.style.opacity)+.1,!0)},10,!0):r.style.opacity=1;var a=c.createElement("DIV");a.innerHTML=e,a.className="tail-writer-dialog tail-writer-dialog-"+t,a.style.display="block",a.style.opacity=0,a.style.position="absolute",this.e.container.appendChild(a),a.style.top=this.e.container.offsetHeight/2-a.offsetHeight/2+"px",a.style.left=this.e.container.offsetWidth/2-a.offsetWidth/2+"px",a.tailWriter=i,this.con.animate?h.animate(a,function(t){return parseFloat(t.style.opacity)<1&&(t.style.opacity=parseFloat(t.style.opacity)+.1,!0)},10,!0):a.style.opacity=1,a.querySelector("form").addEventListener("submit",function(t){t.preventDefault(),this.parentElement.tailWriter.call(n,this.elements,t)&&n.hideDialog.call(n)})}},hideDialog:function(){var t=new Array,e=this.e.container.querySelectorAll(".tail-writer-dialog");if(0<e.length)for(var i=0;i<e.length;i++)t.push(e[i].getAttribute("data-writer-dialog")),this.con.animate?h.animate(e[i],function(t){return 0<parseFloat(t.style.opacity)?(t.style.opacity=parseFloat(t.style.opacity)-.1,!0):(t.parentElement.removeChild(t),!1)},10,!0):e[i].parentElement.removeChild(e[i]);var n=this.e.container.querySelector(".tail-writer-mask");return n&&this.con.animate?h.animate(this.e.container.querySelector(".tail-writer-mask"),function(t){return 0<parseFloat(t.style.opacity)?(t.style.opacity=parseFloat(t.style.opacity)-.1,!0):(t.parentElement.removeChild(t),!1)},10,!0):n.parentElement.removeChild(n),t},remove:function(){this.e.container.removeChild(this.e.toolbar),this.e.container.removeChild(this.e.statusbar);var t=this.e.container.querySelector("textarea");return t.removeAttribute("data-writer-editor"),h.removeClass(t,"tail-writer-editor"),this.e.container.parentElement.replaceChild(t,this.e.container),!0},perform:function(t,e){var i=u(t,e);return!1===i||("function"==typeof i.callback?i.callback.call(this,i.markup,i,t,e):0<=["inline","block"].indexOf(i.callback)&&this["do_"+i.callback].call(this,i.markup,i,t,e),void 0!==i.walker&&i.walker&&(this.walk=[t,e,this.walk instanceof Array?this.walk[2]++:0])),!1},do_inline:function(i,t,e){var n=this.selection(),r=this.val.slice(0,n.start),a=this.val.slice(n.start,n.end),s=this.val.slice(n.end,this.val.length);n.start!==n.end&&-1<a.indexOf("\n\n")?(n.start=r.length,n.end=r.length+(i.length-2)*((a.match(/\n\n/g)||[]).length+1)+a.length,(a=a.split("\n\n")).forEach(function(t,e){a[e]=i.replace("$1",a[e])}),a=o(t,r,a.join("\n\n"),s,n)):(n.start=r.length+i.indexOf("$1"),n.end=r.length+i.indexOf("$1")+a.length,a=o(t,r,i.replace("$1",a),s,n)),this.write(r+a+s,n)},do_block:function(e,t,i){var n=this.selection(),r=this.val.slice(0,n.start),a=this.val.slice(n.start,n.end),s=this.val.slice(n.end,this.val.length);if(n.start!==n.end){var l=this;a=a.replace(/[^|\n]([^\n]+)/g,function(t){return l.indenter(e.replace("$1",t),"create")}),a=o(t,r,a,s,n)}else 0<r.length&&r.length>r.lastIndexOf("\n")+1&&(r+="\n"),a=this.indenter(e.replace("$1",""),"create"),n.start=n.end=r.length+a.length,a=o(t,r,a,s,n);this.write(r+a+s,n)}},"undefined"!=typeof jQuery&&jQuery.fn.extend({tailWriter:function(t){return this.each(function(){return new d(this,t)})}}),void 0!==c.id&&Element.implement({tailWriter:function(t){return new d(this,t)}}),void 0===l.tail&&(l.tail={}),l.tail.writer=d,l.tail.writer}(this);
